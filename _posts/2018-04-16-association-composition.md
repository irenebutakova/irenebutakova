---
published: true
layout: post
title: Association vs Composition. Exploring the difference.
date: 2018-04-16
---
Навеяно дискуссиями в группе...

*Саша.* Начитался я про Агрегацию и Композицию. Аналогий приведено - хоть отбавляй. А вам не кажется, что иногда эти аналогии только запутывают?

*Маша.* Аналогии часто не работают. Вернее не так. Аналогии работают тогда, когда приведены в подходящем контексте.

*Петя.* Выдавай свой подходящий контекст.

*Саша.* А что за контекст?

*Петя.* Помнишь, Пол нам говорил, что любую задачу нужно рассматривать в контексте проблемы, которую она решает.

*Маша.* Именно. Допустим, тебе нужно написать медицинское приложение для обучения анатомии человека. Возьмем, к примеру, тип Body и тип BloodSystem.

*Саша.* Вижу и узнаю Композицию.

*Витя.* И, по-моему, Композиция.

*Маша.* А, по-моему, нет.

*Саша.* Ты хочешь сказать, что здесь уместнее использовать Агрегацию?

*Петя.* Вполне возможно. Ведь анатомию можно изучать при участии BloodSystem, а BloodSystem также можно изучать саму по себе.

*Даша.* Более того, один и тот же объект BloodSystem может быть использован для изучения как male Body, так и female Body.

*Маша.* Поэтому BloodSystem можно создать вне Body, и при уничтожении Body (сборщик мусора) BloodSystem вполне себе может существовать. Отношения Агрегации сводятся к концепции USING. Такой тип отношений между объектами называют WEAK RELATIONSHIP. И зависимость, как правило, внедряется через конструктор, или сеттер.
```c#
public class BloodSystem
{
    ...
}

public class Body
{
    private BloodSystem _bloodSystem;
    public Body(BloodSystem bloodSystem)
    {
       _bloodSystem = bloodSystem;
    }
    ...
}

BloodSystem bloodSystem = new BloodSystem();
Body body = new Body(bloodSystem);

или

Body body = new Body(new BloodSystem() );
```

А Композиция - это как бы способ объединить несколько типов в более сложный тип. Отношения объектов при композиции еще называют death relationship.  Например, BloodSystem и BloodCell. BloodSystem управляет жизненным циклом BloodCell, т.е. при уничтожении BloodSystem (сборщик мусора) BloodСell ожидает та же участь. Такой тип отношений сводится к концепции STRONG RELATIONSHIP.

*Даша.* Помните, Пол нам говорил, что экземпляр дочернего объекта жестко закодирован внутри родительского.

```c#
public class BloodCell
{
    ...
}

public class BloodSystem

{
    BloodCell bodyPart = new BloodCell();
    ...
}
```

*Маша.* Оно самое. Отсюда вытекает, что BloodCell одновременно может быть частью только BloodSystem.

*Даша.* И еще отсюда вытекает, что логически Целое не может быть создано без Части.

*Саша.* Все-таки не могу понять, Агрегация лучше Композиции или Композиция хуже Агрегации?

*Маша.* Моделируй Ассоциацией. Агрегация и Композиция - это формы Ассоциации. И в любом случе это будет означать, что тип А нуждается в API типа В.

*Витя.* Но для начала попытайся определить, имеет ли смысл использовать тип А вне типа В.

*Даша.* Если нет, - это будет Композиция, иначе - Агрегация.

*Саша.* Надеюсь, что когда дойдет до реального проекта, мое моделирование Ассоциациями окажется на высоте.



> Все герои вымышлены, полное или частичное сходство является совпадением.
